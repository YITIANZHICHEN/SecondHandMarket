# 二手市场数据库表结构设计

## 概述
基于本地模拟数据，以下是二手市场应用需要创建的数据库表结构。这些表将支持商品展示、分类管理、卖家信息等功能。

## 核心表结构

### 1. 商品表 (items)
```sql
CREATE TABLE `items` (
    `id` bigint NOT NULL AUTO_INCREMENT COMMENT '商品唯一标识',
    `title` varchar(255) NOT NULL COMMENT '商品标题',
    `price` decimal(10,2) NOT NULL COMMENT '商品价格',
    `image_url` varchar(500) DEFAULT NULL COMMENT '商品图片URL',
    `description` text COMMENT '商品详细描述',
    `category` varchar(50) NOT NULL COMMENT '商品分类',
    `location` varchar(100) DEFAULT NULL COMMENT '商品所在地',
    `seller_id` bigint DEFAULT NULL COMMENT '卖家ID',
    `seller_name` varchar(100) DEFAULT NULL COMMENT '卖家名称',
    `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `status` varchar(20) NOT NULL DEFAULT 'AVAILABLE' COMMENT '商品状态',
    `item_condition` varchar(20) NOT NULL DEFAULT 'GOOD' COMMENT '商品成色',
    `brand` varchar(100) DEFAULT NULL COMMENT '商品品牌',
    `views` int DEFAULT 0 COMMENT '浏览量统计',
    `likes` int DEFAULT 0 COMMENT '点赞数统计',
    PRIMARY KEY (`id`),
    KEY `idx_category` (`category`) COMMENT '分类查询索引',
    KEY `idx_status` (`status`) COMMENT '状态查询索引',
    KEY `idx_created_at` (`created_at`) COMMENT '时间排序索引',
    KEY `idx_seller_id` (`seller_id`) COMMENT '卖家ID索引',
    KEY `idx_price` (`price`) COMMENT '价格排序索引',
    FULLTEXT KEY `idx_search` (`title`, `description`, `brand`) COMMENT '全文搜索索引'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品信息表';
```

**字段说明：**
- `id`: 商品唯一标识，自增主键
- `title`: 商品标题，最大255字符
- `price`: 商品价格，支持小数点后2位
- `image_url`: 商品图片URL，支持长链接
- `description`: 商品详细描述，支持长文本
- `category`: 商品分类，对应ItemCategory枚举
- `location`: 商品所在地
- `seller_id`: 卖家ID，关联卖家表
- `seller_name`: 卖家名称（冗余字段，便于查询）
- `created_at`: 创建时间，默认当前时间
- `status`: 商品状态（AVAILABLE/SOLD/RESERVED）
- `item_condition`: 商品成色（NEW/LIKE_NEW/GOOD/FAIR/POOR）
- `brand`: 商品品牌
- `views`: 浏览量统计
- `likes`: 点赞数统计

### 2. 卖家表 (sellers)
```sql
CREATE TABLE `sellers` (
    `id` bigint NOT NULL AUTO_INCREMENT COMMENT '卖家唯一标识',
    `name` varchar(100) NOT NULL COMMENT '卖家名称',
    `email` varchar(255) DEFAULT NULL COMMENT '卖家邮箱',
    `phone` varchar(20) DEFAULT NULL COMMENT '联系电话',
    `location` varchar(100) DEFAULT NULL COMMENT '卖家所在地',
    `rating` decimal(3,2) DEFAULT 0.0 COMMENT '卖家评分',
    `created_at` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '注册时间',
    `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_email` (`email`) COMMENT '邮箱唯一约束',
    KEY `idx_name` (`name`) COMMENT '名称查询索引',
    KEY `idx_location` (`location`) COMMENT '地区查询索引',
    KEY `idx_rating` (`rating`) COMMENT '评分排序索引'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='卖家信息表';
```

**字段说明：**
- `id`: 卖家唯一标识，自增主键
- `name`: 卖家名称
- `email`: 卖家邮箱，唯一约束
- `phone`: 联系电话
- `location`: 卖家所在地
- `rating`: 卖家评分（0.00-5.00）
- `created_at`: 注册时间
- `updated_at`: 最后更新时间

### 3. 用户收藏表 (user_favorites)
```sql
CREATE TABLE `user_favorites` (
    `id` bigint NOT NULL AUTO_INCREMENT COMMENT '收藏记录ID',
    `user_id` bigint NOT NULL COMMENT '用户ID',
    `item_id` bigint NOT NULL COMMENT '商品ID',
    `created_at` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT '收藏时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_item` (`user_id`, `item_id`) COMMENT '用户商品唯一约束',
    KEY `idx_user_id` (`user_id`) COMMENT '用户ID查询索引',
    KEY `idx_item_id` (`item_id`) COMMENT '商品ID查询索引',
    CONSTRAINT `fk_favorite_item` FOREIGN KEY (`item_id`) REFERENCES `items`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户收藏表';
```

**字段说明：**
- `id`: 收藏记录ID
- `user_id`: 用户ID
- `item_id`: 商品ID，外键关联商品表
- `created_at`: 收藏时间

## 枚举值映射

### 商品分类 (ItemCategory)
```sql
-- 对应的枚举值映射
ELECTRONICS    -> '电子产品'
CLOTHING       -> '服装鞋帽'
BOOKS          -> '图书文具'
HOME           -> '家居用品'
SPORTS         -> '运动户外'
BEAUTY         -> '美妆个护'
TOYS           -> '玩具游戏'
DIGITAL        -> '数码配件'
FURNITURE      -> '家具家电'
OTHER          -> '其他'
```

### 商品状态 (ItemStatus)
```sql
AVAILABLE -> '可购买'
SOLD      -> '已售出'
RESERVED  -> '已预订'
```

### 商品成色 (ItemCondition)
```sql
NEW      -> '全新'
LIKE_NEW -> '几乎全新'
GOOD     -> '良好'
FAIR     -> '一般'
POOR     -> '较差'
```

## 索引优化建议

### 查询优化索引
1. **分类查询**: `idx_category` - 支持按分类筛选
2. **状态查询**: `idx_status` - 支持按状态筛选
3. **时间排序**: `idx_created_at` - 支持按时间倒序
4. **价格排序**: `idx_price` - 支持按价格排序
5. **全文搜索**: `idx_search` - 支持标题、描述、品牌搜索

### 外键约束
- `user_favorites.item_id` 关联 `items.id`
- `items.seller_id` 关联 `sellers.id`

## 示例数据

### 商品表示例
```sql
INSERT INTO items (title, price, image_url, description, category, location, seller_name, status, item_condition, brand, views, likes) VALUES
('iPhone 13 Pro 256GB', 6999.00, 'https://example.com/iphone13pro.jpg', '几乎全新的iPhone 13 Pro，深空黑色，256GB存储，电池健康度98%', 'ELECTRONICS', '北京市朝阳区', '数码达人小王', 'AVAILABLE', 'LIKE_NEW', 'Apple', 892, 156),
('MacBook Air M1', 5599.00, 'https://example.com/macbook_air.jpg', '2020款MacBook Air，M1芯片，8GB内存，256GB SSD，性能强劲', 'ELECTRONICS', '上海市浦东新区', '程序员小李', 'AVAILABLE', 'GOOD', 'Apple', 1245, 234),
('Nike Air Jordan 1 芝加哥', 1299.00, 'https://example.com/aj1_chicago.jpg', '正品AJ1芝加哥配色，尺码42，仅穿过2次，品相很好', 'CLOTHING', '广州市天河区', '潮流玩家', 'AVAILABLE', 'LIKE_NEW', 'Nike', 567, 89);
```

## 使用说明

1. **创建表顺序**: 先创建sellers表，再创建items表，最后创建user_favorites表
2. **数据初始化**: 可以使用ItemDao中的initializeTestData()方法初始化测试数据
3. **性能优化**: 对于大数据量，建议定期优化表和索引
4. **备份策略**: 建议定期备份商品和卖家数据

这个表结构设计完全基于项目的本地模拟数据，支持所有现有的功能需求，包括分类浏览、搜索、收藏等核心功能。